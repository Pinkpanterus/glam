<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>glam</title>
</head>
<body>
	<div id="container" style="width:98%; height:98%; position:absolute;background-color:red"></div>

	<script src="../../build/glam.js"></script>
	<script>

	window.addEventListener('load', function(){
		var container = document.getElementById("container");
		
		var app = new glam.Application({ container : container });
		app.focus();
		
		var cube = new glam.Object;
		cube.transform.position.z = -10;
		cube.transform.rotation.x = Math.PI / 5;

		var visual = new glam.Visual(
				{ geometry: new THREE.BoxGeometry(2, 2, 2),
					material: new THREE.MeshBasicMaterial({color:0xeeeeee, 
						map:new THREE.TextureLoader().load("./images/board.png")})
				});


		var picker = new glam.Picker;
		picker.addEventListener("mouseover", function() { highlight.on(); });
		picker.addEventListener("mouseout", function() { highlight.off(); });
		picker.addEventListener("mouseup", function() { animator.start(); });
						
		var highlight = new glam.HighlightBehavior({});
		var animator = createAnimation(cube);

		cube.addComponent(visual);
		cube.addComponent(picker);
		cube.addComponent(highlight);
		cube.addComponent(animator);

 		app.addObject(cube);

		app.run();
	},
	false
	);

	function createAnimation(obj) {
		var rotator = {
			keys : [ 0, .5, 1],
			values : [
				{ y: 0 },
				{ y : Math.PI },
				{ y : Math.PI * 2 },
			],
			target: obj.transform.rotation
		};

		var mover = {
			keys : [ 0, 1],
			values : [
				{ z: -10 },
				{ z : -20 },
			],
			target: obj.transform.position
		};

		var interps = [ rotator, mover ];

		return new glam.KeyFrameAnimator({
			interps : interps,
			duration : 5000, // ms
			loop : true
		});
	}


	</script>
	
</body>
</html>